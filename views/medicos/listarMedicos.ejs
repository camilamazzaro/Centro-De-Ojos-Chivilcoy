<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Usuarios</title>
    <link rel="stylesheet" href="/public/css/medicos.css">
    <%- include('../commons/head') %>
</head>

<body>
    <div class="contenedor-flex">
        <div class="contenedor-barra-lateral">
            <%- include('../commons/barra-lateral-admin') %>
        </div>
    
        <div class="contenedor-listado-agregar">
            <div class="contenedor mt-5 container-listado-medicos">
                <h1>Listado de Médicos</h1>
                <div class="listado-medicos">
                    <table class="table table-striped table-bordered border rounded shadow-lg">
                        <!-- <thead>
                            <tr>
                                <th class="col">ID</th>
                                <th class="col">Nombre</th>
                                <th class="col">Teléfono</th>
                                <th class="col">Descripción</th>
                                <th class="col">Foto</th>
                                <th class="col">Horarios</th>
                                <th class="col">Acciones</th>
                            </tr>
                        </thead> -->
                        <tbody>
                            <% medicos.forEach(function(medico) { %>
                                <tr>
                                    <!-- Columna con imagen redondeada, nombre y teléfono -->
                                    <td class="contenedor-medico">
                                        <img class="foto-medico" width="100" height="100" src="<%= medico.foto %>" alt="">
                                    </td>

                                    <td class="contenedor-datos-medico">
                                        <strong><%= medico.nombre_medico %></strong>
                                            <p class="telefono-medico"><%= medico.telefono %></p>
                                    </td>
                        
                                    <!-- Columna de descripción -->
                                    <td class="contenedor-descripcion">
                                        <%= medico.descripcion %>
                                    </td>

                                    <!-- Columna de matrícula provincial -->
                                    <td class="contenedor-matricula">
                                        M.P. <%= medico.matricula %>
                                    </td>
                                    
                                    <!-- Columna de horarios -->
                                    <td class="horarios">
                                        
                                        <!--Botón de ver y editar horarios-->
                                        <button class="btn-ver-horarios">
                                            <a href="/medico/<%= medico.id %>/horarios" class="ver-editar-horarios">
                                                Ver Horarios
                                                <i class="fa-regular fa-clock"></i>
                                            </a>
                                        </button>
                                    </td>

                                    <td>
                                        <a class="btn-editar" href="/medico/editar/<%= medico.id %>">
                                            <i class="fa-regular fa-pen-line"></i>
                                            Editar
                                        </a>
                                        <button class="btn-eliminar btnEliminar" data-id="<%= medico.id %>"><i class="fa-regular fa-trash-can"></i></button>
                                        
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                        
                    </table>
                </div>

                <div id="btn-agregar" class="btn-agregar">
                    <button class="btn-wave">
                        <a href="/medico/agregar/0">Agregar Nuevo Médico</a>
                    </button>
                </div>
            </div>
        
            <!-- Ícono de flecha fijo en la esquina inferior derecha -->
            <div class="atajo-agregar" id="atajo-agregar">
                <a href="#btn-agregar" class="btn-flecha" id="btn-flecha">
                    <i class="fa-solid fa-arrow-down"></i>
                </a>
            </div>
        </div>
    </div>


    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.querySelectorAll('.btnEliminar').forEach(button => {
            button.addEventListener('click', async () => {
                const medicoId = button.getAttribute('data-id');

                // Mostrar un SweetAlert de confirmación antes de eliminar
                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "Esta acción eliminará al médico de la lista. No podrás deshacerlo.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sí, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        // Si el usuario confirma la eliminación, se hace la petición al backend
                        const response = await fetch(`/medicos/eliminar/${medicoId}`, {
                            method: 'DELETE'
                        });

                        // Verificar si la eliminación fue exitosa y actualizar la vista
                        if (response.ok) {
                            Swal.fire({
                                title: 'Eliminado!',
                                text: 'El médico ha sido eliminado correctamente.',
                                icon: 'success',
                                confirmButtonText: 'Aceptar'
                            }).then(() => {
                                location.reload(); // Recargar la página para actualizar la lista
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'Hubo un problema al eliminar el médico.',
                                icon: 'error',
                                confirmButtonText: 'Aceptar'
                            });
                        }
                    }
                });
            });
        });


        //Botón fixed
        const atajoAgregar = document.getElementById('atajo-agregar');
        const btnFlecha = document.getElementById('btn-flecha');
        let lastScrollTop = 0;

        // Manejar el clic en el botón de flecha
        btnFlecha.addEventListener('click', () => {
            atajoAgregar.classList.add('hidden'); // Oculta el contenedor
        });

        // Mostrar/ocultar el contenedor basado en el scroll
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            // Compara la posición del scroll actual con la anterior
            if (scrollTop < lastScrollTop) {
                // Scrolling hacia arriba
                atajoAgregar.classList.remove('hidden'); // Muestra el contenedor
            } else {
                // Scrolling hacia abajo
                atajoAgregar.classList.add('hidden'); // Oculta el contenedor
            }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // Para evitar valores negativos
        });
    </script>
</body>
</html>
