<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../commons/head-web') %>
    <title>Información médico</title>
    <link rel="stylesheet" href="/public/css/web/profesionales.css">
</head>


<body>

    <!-- Menú de navegación -->
    <%- include('../commons/menu-web') %>

    
    <a href="/profesionales" class="boton-regresar"> ← Regresar a Profesionales</a>

    <!--traemos la info de los medicos de la bd-->
    <div class="container-info-medico">
        <div class="medico-info">
            <img class="medicofoto-ver-mas" src="<%= medico.foto %>" alt="Foto de <%= medico.nombre_medico %>">
            <div class="medico-detalles">
                <h2><%= medico.nombre_medico %></h2>
                <hr>
                <p><%= medico.descripcion %></p>
                <div class="practicas-medico">
                    <ul>
                        <% if (practicas && practicas.length > 0) { %>
                            <% practicas.forEach(practica => { %>
                                <li><i class="fa-solid fa-circle-check"></i>  <%= practica.nombre %></li>
                            <% }) %>
                        <% } else { %>
                            <li>No hay prácticas disponibles para este médico.</li>
                        <% } %>
                    </ul>
                </div>
                <div class="horarios-coberturas">
                    <a href="javascript:void(0);" onclick="mostrarModal()" class="medico-ver-horarios">
                        <i class="fa-regular fa-clock-nine"></i>
                        Ver Horarios</a>
                    <!--Obras sociales del médico-->
                    <div class="medico-coberturas">
                        <% if (coberturas.length > 0) { %>
                            <select id="obrasSocialesSelect" class="styled-select">
                                <option value="" disabled selected>Ver Obras Sociales</option>
                                <% coberturas.forEach(cobertura => { %>
                                    <option value="<%= cobertura.id %>"><%= cobertura.nombre %></option>
                                <% }); %>
                            </select>
                        <% } else { %>
                            <p>Este médico no trabaja con obras sociales.</p>
                        <% } %>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="modal-horarios" class="modal-horarios">
        <div class="modal-horarios-contenido">
            <span class="close" onclick="cerrarModal()">&times;</span>
            <h5>Horarios Disponibles</h5>
            <div class="lista-horarios-container">
                <ul class="lista-horarios">
                    <% if (horarios && horarios.length > 0) { 
                        
                        /* 1. MAPA DE TRADUCCIÓN (DB -> VISTA) */
                        /* Las claves deben coincidir EXACTO con lo que viene de la BD (minúsculas, sin tilde) */
                        const nombresDias = {
                            "lunes": "Lunes",
                            "martes": "Martes",
                            "miercoles": "Miércoles",
                            "jueves": "Jueves",
                            "viernes": "Viernes",
                            "sabado": "Sábado",
                            "domingo": "Domingo"
                        };

                        /* 2. ORDEN DE LOS DÍAS */
                        /* Para que siempre aparezca Lunes primero, luego Martes, etc. */
                        const ordenDias = ["lunes", "martes", "miercoles", "jueves", "viernes", "sabado", "domingo"];

                        /* 3. AGRUPAR HORARIOS */
                        const horariosPorDia = {};

                        horarios.forEach(h => {
                            const diaDb = h.dia_semana.toLowerCase(); // Aseguramos minúsculas
                            
                            // Formato de hora simple: "16:30:00" -> "16:30"
                            // Cortamos los primeros 5 caracteres del string
                            const inicio = h.hora_inicio.substring(0, 5);
                            const fin = h.hora_fin.substring(0, 5);

                            if (!horariosPorDia[diaDb]) {
                                horariosPorDia[diaDb] = [];
                            }
                            horariosPorDia[diaDb].push(`de ${inicio} a ${fin}hs`);
                        });
                    %>

                        <% ordenDias.forEach(diaKey => { 
                            if (horariosPorDia[diaKey]) { %>
                                <li>
                                    <strong class="dia-semana"><%= nombresDias[diaKey] %>:</strong> 
                                    <span><%= horariosPorDia[diaKey].join(' / ') %></span>
                                </li>
                            <% } 
                        }); %>

                    <% } else { %>
                        <li class="sin-horarios">No tiene horarios asignados actualmente.</li>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>

    <!--FOOTER-->
    <%- include('../commons/footer-web') %>

    <script type="text/javascript">

        //mostrar horarios del médico
        function mostrarModal() {
            document.getElementById("modal-horarios").style.display = "block";
        }
        
        //cerrar lo de arriba
        function cerrarModal() {
            document.getElementById("modal-horarios").style.display = "none";
        }

        //cambia la visibilidad de los horarios
        function toggleCambiarPasswordForm(){
            if(CambiarPassForm.style.display === "none") {
                CambiarPassForm.style.display = "block";
            } else {
                CambiarPassForm.style.display = "none";
            }
        }

    </script>

</body>
</html>
